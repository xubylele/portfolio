---
import { languages, type Lang } from '../../i18n/ui';
import { getLangFromUrl, getRelativeUrl } from '../../i18n/utils';

const currentLang = getLangFromUrl(Astro.url);
---

<div class="relative group">
  <button
    class="flex items-center gap-2 text-white/80 hover:text-white transition-all duration-300 text-sm font-medium px-3 py-2 rounded-md hover:bg-white/10 hover:scale-105"
    aria-label="Select language"
  >
    <span class="transition-all duration-300">{languages[currentLang]}</span>
    <i class="fa-solid fa-chevron-down text-xs transition-transform duration-300 group-hover:rotate-180"></i>
  </button>
  
  <div class="absolute right-0 top-full mt-2 bg-[#4b1e3d]/95 backdrop-blur-sm rounded-md shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 min-w-[120px] transform origin-top scale-95 group-hover:scale-100">
    <ul class="py-2">
      {Object.entries(languages).map(([lang, label], index) => (
        <li class="overflow-hidden">
          <a
            href={getRelativeUrl(Astro.url, lang as Lang)}
            class={`block px-4 py-2 text-sm transition-all duration-300 transform hover:translate-x-1 ${
              currentLang === lang
                ? 'text-[#f6ea5d] bg-white/10 scale-105'
                : 'text-white/80 hover:text-white hover:bg-white/5'
            }`}
            hreflang={lang}
            style={`animation-delay: ${index * 50}ms`}
          >
            {label}
          </a>
        </li>
      ))}
    </ul>
  </div>
</div>

<style>
  .group:hover .group-hover\:rotate-180 {
    transform: rotate(180deg);
  }
  
  .group:hover .group-hover\:scale-100 {
    animation: slideIn 0.3s ease-out;
  }
  
  @keyframes slideIn {
    from {
      opacity: 0;
      transform: scale(0.95) translateY(-10px);
    }
    to {
      opacity: 1;
      transform: scale(1) translateY(0);
    }
  }
  
  .group:hover li a {
    animation: fadeInSlide 0.3s ease-out forwards;
    opacity: 0;
    transform: translateX(-10px);
  }
  
  @keyframes fadeInSlide {
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }
</style>
